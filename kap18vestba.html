<!DOCTYPE html>
<html lang="cs"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kapitola 18 – Věštba z run (4/4)</title>
<link rel="stylesheet" href="css/style.css">
<script defer src="js/helpers.js"></script>
<script defer src="js/runes.js"></script>
</head><body>
<div class="container">
  <div class="nav"><button class="btn" onclick="restartRunes()">↺ Věštit znovu</button></div>
  <h1>Kapitola 18 – Věštba z run (4/4)</h1>
  <div class="panel"><div class="dialogue">
  <img src="img/alchemista_svitek_ukol.png" alt="Alchymista" class="avatar">
  <div class="bubble"><p><strong>Alchymista:</strong> „Dobře. Mám <strong>TŘI RUNY</strong>. Teď je spojím – ať promluví.“</p></div>
</div>
<div class="bubble">
  <p id="qline" class="small"></p>
  <p><strong>Vybrané runy:</strong> <span id="runesRow"></span></p><hr>
  <p id="v1"></p><p id="v2"></p><p id="v3"></p>
</div>
<div id="cont"></div>
<script>
// Avatar efekt: změna obrázku na mávajícího alchymistu na 1 sekundu
document.addEventListener('DOMContentLoaded', function() {
  var avatar = document.querySelector('.avatar');
  if(avatar) {
    var origSrc = avatar.getAttribute('src');
    avatar.addEventListener('click', function() {
      avatar.src = 'img/alchymista_mavajici.png';
      setTimeout(function() {
        avatar.src = origSrc;
      }, 1000);
    });
  }
});
const QMAP = {
  'default': '',
  'today':  'Otázka: Co dnes potřebuji vědět?',
  'fight':  'Otázka: Jak dopadne boj?',
  'future': 'Otázka: Co přinese budoucnost?'
};
function setRunesRow(r1, r2, r3){
  document.getElementById('runesRow').textContent = r1+' • '+r2+' • '+r3;
}
function restartRunes(){
  try{
    localStorage.removeItem('r1');
    localStorage.removeItem('r2');
    localStorage.removeItem('r3');
  }catch(e){}
  window.location.href = 'kap18.html';
}
async function load(){
  const r1 = localStorage.getItem('r1')||'—';
  const r2 = localStorage.getItem('r2')||'—';
  const r3 = localStorage.getItem('r3')||'—';
  const qt = (localStorage.getItem('rq')||'default');
  const qline = QMAP[qt]||'';
  document.getElementById('qline').textContent = qline;
  setRunesRow(r1, r2, r3);
  try{
    await Runes.loadRunes();
    const { lines } = Runes.generateForecast(r1, r2, r3);
    document.getElementById('v1').textContent = lines.start;
    document.getElementById('v2').textContent = lines.obstacle;
    document.getElementById('v3').textContent = lines.result;
  }catch(e){
    const MAP = {"Algiz": ["Cesta začíná pod štítem ochrany.", "Ale i štít může prasknout.", "Nakonec budeš chráněna, když zůstaneš věrná svým instinktům."], "Ansuz": ["Slovo otevře první dveře.", "Slova mohou i klamat.", "Nakonec pravda promluví jasně."], "Berkana": ["Z temnoty se rodí nový začátek.", "Ale zrození je bolestné a nejisté.", "Nakonec vykvete, co bylo zaseto."], "Dagaz": ["Den se láme, nastává změna.", "Ale změna přináší chaos.", "Nakonec vyjde světlo nad obzorem."], "Fehu": ["Na začátku stojí zisk a hojnost.", "Majetek může svázat i oslepit.", "Nakonec zůstane to, co má hodnotu v srdci."]};
    function line(r, i){ if(MAP[r]) return MAP[r][i]; const g=[["Začátek šeptá o kroku vpřed.","První krok bývá nejistý.","Nakonec cesta ví, kam vede."]]; return g[0][i]; }
    document.getElementById('v1').textContent = line(r1,0);
    document.getElementById('v2').textContent = line(r2,1);
    document.getElementById('v3').textContent = line(r3,2);
  }
  document.getElementById('cont').innerHTML = `<a class='continue-btn' href='kap19.html'>👉 Pokračovat (Kapitola 19)</a>`;
}
window.addEventListener('DOMContentLoaded', load);
</script>
</div>
</div>
</body></html>
