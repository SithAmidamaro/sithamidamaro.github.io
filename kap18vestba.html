<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kapitola 18 – Věštba z run (4/4)</title>
  <link rel="stylesheet" href="css/style.css">
  <script defer src="js/helpers.js"></script>
  <script defer src="js/runes.js"></script>
  <style>
    .trinity p { margin: .35rem 0; }
    .tag { opacity: .8; font-weight: 600; margin-right: .35rem; }
    .qswitch { margin-top: 8px; }
    .qswitch .btn { margin-right: 6px; margin-bottom: 6px; }
  </style>
</head>
<body>
<div class="container">
  <div class="nav">
    <button class="btn" onclick="restartRunes()">↺ Věštit znovu</button>
    <a class="btn" href="kap19.html">👉 Pokračovat (Kapitola 19)</a>
  </div>
  <h1>Kapitola 18 – Věštba z run (4/4)</h1>

  <div class="panel">
    <div class="dialogue">
      <img src="img/alchymista_mavajici.png" alt="Alchymista" class="avatar">
      <div class="bubble"><p><strong>Alchymista:</strong> „Dobře. Mám tři jména. Teď je spojím – ať promluví.“</p></div>
    </div>

    <div class="bubble">
      <p><strong>Otázka:</strong> <span id="qRow">—</span></p>
      <p><strong>Vybrané runy:</strong> <span id="runesRow"></span></p>
      <div class="qswitch">
        <span class="small" style="opacity:.85;">Změnit otázku:</span>
        <button class="btn small" data-q="today">Dnes</button>
        <button class="btn small" data-q="fight">Boj</button>
        <button class="btn small" data-q="future">Budoucnost</button>
      </div>
      <hr>
      <div class="trinity">
        <p id="v1"></p>
        <p id="v2"></p>
        <p id="v3"></p>
      </div>
    </div>
  </div>
</div>

<script>
function setRunesRow(r1, r2, r3){
  document.getElementById('runesRow').textContent = r1+' • '+r2+' • '+r3;
}
function restartRunes(){
  try{
    localStorage.removeItem('r1');
    localStorage.removeItem('r2');
    localStorage.removeItem('r3');
  }catch(e){}
  window.location.href = 'kap18.html';
}
function questionHuman(q){
  if(q==='today') return 'Co dnes potřebuji vědět?';
  if(q==='fight') return 'Jak dopadne boj?';
  if(q==='future') return 'Co přinese budoucnost?';
  return '—';
}
async function render(){
  const r1 = localStorage.getItem('r1')||'—';
  const r2 = localStorage.getItem('r2')||'—';
  const r3 = localStorage.getItem('r3')||'—';
  const q = localStorage.getItem('q')||'today';
  document.getElementById('qRow').textContent = questionHuman(q);
  setRunesRow(r1, r2, r3);
  await Runes.loadRunes();
  const { lines } = Runes.generateForecast(r1, r2, r3);
  document.getElementById('v1').innerHTML = '<span class="tag">Minulost:</span>' + lines.past;
  document.getElementById('v2').innerHTML = '<span class="tag">Přítomnost:</span>' + lines.present;
  document.getElementById('v3').innerHTML = '<span class="tag">Budoucnost:</span>' + lines.future;
}
function onQSwitch(ev){
  const b = ev.target.closest('button[data-q]');
  if(!b) return;
  const q = b.getAttribute('data-q');
  localStorage.setItem('q', q);
  render();
}
window.addEventListener('DOMContentLoaded', ()=>{
  document.querySelector('.qswitch').addEventListener('click', onQSwitch);
  render().catch(e=>{
    document.getElementById('v1').textContent = 'Nepodařilo se sestavit věštbu.';
  });
});
</script>
</body>
</html>
