<!DOCTYPE html>
<html lang="cs"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kapitola 18 â€“ VÄ›Å¡tÄ›nÃ­ z run (vÃ½bÄ›r 1â€“3/4)</title>
<link rel="stylesheet" href="css/style.css">
<script defer src="js/helpers.js"></script>
<script defer src="js/runes.js"></script>
<style>
  .q-grid{ display:flex; gap:.5rem; flex-wrap:wrap; margin:.5rem 0; }
  .q-btn{ cursor:pointer; }
  .q-btn.selected{ outline:2px solid var(--accent, #444); }
</style>
</head><body>
<div class="container">
  <div class="nav"><a class="btn" href="kap17a.html">â† ZpÄ›t</a><a class="btn" href="index.html">ğŸ  DomÅ¯</a></div>
  <h1>Kapitola 18 â€“ VÄ›Å¡tÄ›nÃ­ z run (vÃ½bÄ›r 1â€“3/4)</h1>
  <div class="panel">
    <div class="dialogue">
      <img src="img/alchymista_mavajici.png" alt="Alchymista" class="avatar">
      <div class="bubble">
        <p><strong>Alchymista:</strong> <span id="prompt">â€Vyber 1. runu â€“ <em>ZAÄŒÃTEK</em>. AÅ¥ jsou tÅ™i rÅ¯znÃ© â€“ osud rÃ¡d mluvÃ­ tÅ™emi hlasy.â€œ</span></p>
      </div>
    </div>

    <div class="bubble">
      <label class="small"><strong>Nejprve otÃ¡zka:</strong></label>
      <div id="qgrid" class="q-grid"></div>
      <p class="small" id="qhint"></p>
    </div>

    <div class="bubble" id="selector">
      <label class="small" id="labelRole">Vyber 1. runu (ZAÄŒÃTEK):</label>
      <div id="grid" class="rune-grid"></div>
      <p id="hint" class="feedback"></p>
      <hr>
      <p class="small"><strong>VybranÃ© runy:</strong> <span id="summary">â€” â€¢ â€” â€¢ â€”</span></p>
    </div>
  </div>
</div>
<script>
const ROLES = ['ZAÄŒÃTEK','PÅ˜EKÃÅ½KA','VÃSLEDEK'];
const QUESTIONS = [
  { id:'default', label:'Bez konkrÃ©tnÃ­ otÃ¡zky' },
  { id:'today',   label:'Co dnes potÅ™ebuji vÄ›dÄ›t?' },
  { id:'fight',   label:'Jak dopadne boj?' },
  { id:'future',  label:'Co pÅ™inese budoucnost?' }
];
let step = 1; // 1..3
let runes = [];
let sel = { 1: null, 2: null, 3: null };
let qsel = 'default';

function loadFromStorage(){
  sel[1] = localStorage.getItem('r1');
  sel[2] = localStorage.getItem('r2');
  sel[3] = localStorage.getItem('r3');
  qsel   = localStorage.getItem('rq') || 'default';
  if(!sel[1]) step=1; else if(!sel[2]) step=2; else if(!sel[3]) step=3; else step=3;
}
function saveToStorage(){
  if(sel[1]) localStorage.setItem('r1', sel[1]);
  if(sel[2]) localStorage.setItem('r2', sel[2]);
  if(sel[3]) localStorage.setItem('r3', sel[3]);
  if(qsel)   localStorage.setItem('rq', qsel);
}
function updateSummary(){
  const s1 = sel[1] || 'â€”';
  const s2 = sel[2] || 'â€”';
  const s3 = sel[3] || 'â€”';
  document.getElementById('summary').textContent = s1 + ' â€¢ ' + s2 + ' â€¢ ' + s3;
}
function setPrompts(){
  document.getElementById('labelRole').textContent = `Vyber ${step}. runu (${ROLES[step-1]}):`;
  document.getElementById('prompt').innerHTML = `â€Vyber ${step}. runu â€“ <em>${ROLES[step-1]}</em>. AÅ¥ jsou tÅ™i rÅ¯znÃ© â€“ osud rÃ¡d mluvÃ­ tÅ™emi hlasy.â€œ`;
}
function disabledSet(){
  const s = new Set();
  if(sel[1]) s.add(sel[1].toLowerCase());
  if(sel[2]) s.add(sel[2].toLowerCase());
  if(step===1){ s.delete(sel[1]?.toLowerCase()); }
  if(step===2){ s.delete(sel[2]?.toLowerCase()); }
  if(step===3){ s.delete(sel[3]?.toLowerCase()); }
  return s;
}
function renderGrid(){
  const g = document.getElementById('grid');
  const dis = disabledSet();
  g.innerHTML = runes.map(r=>{
    const isDisabled = dis.has((r.name||'').toLowerCase());
    const isSelected = (sel[step] && sel[step].toLowerCase() === (r.name||'').toLowerCase());
    const classes = 'btn rune-card' + (isSelected ? ' selected' : '');
    const attrDis = isDisabled ? 'disabled' : '';
    return `<button class='${classes}' ${attrDis} onclick='pickRune("${r.name}")'>
      <img src='runes/${r.id}.png' alt='${r.name}'>
      <span class='caption'>${r.name}</span>
    </button>`;
  }).join('');
}
function renderQuestions(){
  const g = document.getElementById('qgrid');
  g.innerHTML = QUESTIONS.map(q=>{
    const classes = 'btn q-btn' + (qsel === q.id ? ' selected' : '');
    return `<button class='${classes}' onclick='setQuestion("${q.id}")'>${q.label}</button>`;
  }).join('');
  document.getElementById('qhint').textContent = QUESTIONS.find(q=>q.id===qsel)?.label || '';
}
function setQuestion(id){
  qsel = id;
  saveToStorage();
  renderQuestions();
}
function pickRune(name){
  sel[step] = name;
  saveToStorage();
  updateSummary();
  if(step < 3){
    step++;
    setPrompts();
    renderGrid();
    document.getElementById('hint').textContent = '';
  }else{
    window.location.href = 'kap18vestba.html';
  }
}
async function init(){
  loadFromStorage();
  renderQuestions();
  try{
    runes = await fetch('data/runes.json', {cache:'no-store'}).then(r=>r.json());
  }catch(e){
    document.getElementById('hint').textContent = 'NepodaÅ™ilo se naÄÃ­st seznam run.';
    return;
  }
  setPrompts();
  updateSummary();
  renderGrid();
}
window.addEventListener('DOMContentLoaded', init);
</script>
</body></html>
